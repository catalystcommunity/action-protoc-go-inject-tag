name: 'protoc-go-inject-tag'
description: 'Uses [protoc-go-inject-tag](https://github.com/favadi/protoc-go-inject-tag) to inject struct tags into go structs generated by protoc'
inputs:
  go-version:
    description: 'Version of golang to use'
    required: false
    default: '~1.18'
  working-directory:
    description: 'Directory to run the command from'
    required: false
    default: '.'
  protoc-go-inject-tag-version:
    description: 'Version of protoc-go-inject-tag to use'
    required: false
    default: 'v1.4.0'
  files:
    description: 'Comma separated list of file paths to run protoc-go-inject-tag on'
    required: false
    default: "*.pb.go"
  commit:
    description: 'If true, will commit the modified files'
    required: false
    default: true
  commit-message:
    description: 'commit message to use when pushing generated code'
    required: false
    default: 'chore: injected tags into go structs [skip ci]'
  checkout:
    description: 'set to true to checkout the repository, set to false if you are checking out the repository before using this action'
    required: false
    default: true
  ref:
    description: 'Ref to checkout'
    required: false
    default: ${{ github.head_ref }}
  token:
    description: 'Git token to use'
    required: false
    default: ${{ github.token }}
runs:
  using: "composite"
  steps:
    - name: Checkout
      if: inputs.checkout == 'true'
      uses: actions/checkout@v3
      with:
        token: ${{ inputs.token }}
        ref: ${{ inputs.ref }}
        path: ${{ inputs.checkout-path }}
    - name: Setup Go With Caching
      uses: magnetikonline/action-golang-cache@v1
      with:
        go-version: ${{ inputs.go-version }}
    - name: Install go install github.com/favadi/protoc-go-inject-tag
      shell: bash
      run: |
        go install github.com/favadi/protoc-go-inject-tag@${{ inputs.protoc-go-inject-tag-version }}
    - name: Git status
      shell: bash
      run: |
        git status
    - name: Run protoc-go-inject-tag
      shell: bash
      run: |
        IFS=',' read -ra ADDR <<< "${{ inputs.files }}"
        for i in "${ADDR[@]}"; do
        protoc-go-inject-tag -input="$i"
        done
    - name: Git status
      shell: bash
      run: |
        git status
    - name: Commit
      if: inputs.commit == 'true'
      uses: stefanzweifel/git-auto-commit-action@v4
      with:
        commit_message: ${{ inputs.commit-message }}