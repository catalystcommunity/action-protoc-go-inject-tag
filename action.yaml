name: 'protoc-go-inject-tag'
description: 'Uses [protoc-go-inject-tag](https://github.com/favadi/protoc-go-inject-tag) to inject struct tags into go structs generated by protoc'
inputs:
  go-version:
    description: 'Version of golang to use'
    required: false
    default: '~1.18'
  working-directory:
    description: 'Directory to run the command from'
    required: false
    default: '.'
  protoc-go-inject-tag-version:
    description: 'Version of protoc-go-inject-tag to use'
    required: false
    default: 'latest'
  files:
    description: 'Comma separated list of file paths to run protoc-go-inject-tag on'
    required: false
    default: "*.pb.go"
  commit:
    description: 'If true, will commit the modified files'
    required: false
    default: true
runs:
  using: "composite"
  steps:
    - name: Checkout
      uses: actions/checkout@v2
    - name: Setup Go With Caching
      uses: magnetikonline/action-golang-cache@v1
      with:
        go-version: ${{ inputs.go-version }}
    - name: Install go install github.com/favadi/protoc-go-inject-tag
      shell: bash
      run: |
        go install github.com/favadi/protoc-go-inject-tag@${{ inputs.go-version }}
    - name: Run protoc-go-inject-tag
      shell: bash
      run: |
        IFS=',' read -ra ADDR <<< "${{ inputs.files }}"
        for i in "${ADDR[@]}"; do
        protoc-go-inject-tag -input="$i"
        done
    - name: Commit
      if: inputs.commit == 'true'
      uses: stefanzweifel/git-auto-commit-action@v4